# =============================================================================
# Neolith Web App - Railway Deployment Configuration
# =============================================================================
# This configuration deploys the Neolith Next.js web application to Railway.
#
# Prerequisites:
#   - Railway CLI installed: npm install -g @railway/cli
#   - Login to Railway: railway login
#   - Link project: railway link
#
# Deployment:
#   cd packages/@wundr/neolith/apps/web && railway up
#
# =============================================================================

[build]
builder = "NIXPACKS"
# Build from repo root to access pnpm-lock.yaml and all workspace packages
# Railway will detect pnpm from the lockfile automatically
buildCommand = """
cd ../../../../../ && \
pnpm install --frozen-lockfile && \
pnpm --filter @neolith/database exec prisma generate && \
pnpm --filter @neolith/web build
"""

[deploy]
# Start the Next.js production server
startCommand = "node .next/standalone/packages/@wundr/neolith/apps/web/server.js"
healthcheckPath = "/api/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
numReplicas = 1

[env]
NODE_ENV = "production"
PORT = "3000"
HOSTNAME = "0.0.0.0"
# Note: Set sensitive env vars in Railway dashboard:
# DATABASE_URL, AUTH_SECRET, NEXTAUTH_URL, etc.
