'use client';

import { Search } from 'lucide-react';
import { useState, useMemo } from 'react';

import { Button } from '@/components/ui/button';
import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';
import { ScrollArea } from '@/components/ui/scroll-area';
import { cn } from '@/lib/utils';

interface EmojiPickerProps {
  value?: string;
  onChange: (emoji: string) => void;
  trigger?: React.ReactNode;
}

const EMOJI_CATEGORIES = {
  'Smileys & People': [
    'ðŸ˜€',
    'ðŸ˜ƒ',
    'ðŸ˜„',
    'ðŸ˜',
    'ðŸ˜…',
    'ðŸ˜‚',
    'ðŸ¤£',
    'ðŸ˜Š',
    'ðŸ˜‡',
    'ðŸ™‚',
    'ðŸ™ƒ',
    'ðŸ˜‰',
    'ðŸ˜Œ',
    'ðŸ˜',
    'ðŸ¥°',
    'ðŸ˜˜',
    'ðŸ˜—',
    'ðŸ˜™',
    'ðŸ˜š',
    'ðŸ˜‹',
    'ðŸ˜›',
    'ðŸ˜',
    'ðŸ˜œ',
    'ðŸ¤ª',
    'ðŸ¤¨',
    'ðŸ§',
    'ðŸ¤“',
    'ðŸ˜Ž',
    'ðŸ¤©',
    'ðŸ¥³',
    'ðŸ˜',
    'ðŸ˜’',
    'ðŸ˜ž',
    'ðŸ˜”',
    'ðŸ˜Ÿ',
    'ðŸ˜•',
    'ðŸ™',
    'ðŸ˜£',
    'ðŸ˜–',
    'ðŸ˜«',
    'ðŸ˜©',
    'ðŸ¥º',
    'ðŸ˜¢',
    'ðŸ˜­',
    'ðŸ˜¤',
    'ðŸ˜ ',
    'ðŸ˜¡',
    'ðŸ¤¬',
    'ðŸ¤¯',
    'ðŸ˜³',
    'ðŸ¥µ',
    'ðŸ¥¶',
    'ðŸ˜±',
    'ðŸ˜¨',
    'ðŸ˜°',
    'ðŸ˜¥',
    'ðŸ˜“',
    'ðŸ¤—',
    'ðŸ¤”',
    'ðŸ¤­',
    'ðŸ¤«',
    'ðŸ¤¥',
    'ðŸ˜¶',
    'ðŸ˜',
    'ðŸ˜‘',
    'ðŸ˜¬',
    'ðŸ™„',
    'ðŸ˜¯',
    'ðŸ˜¦',
    'ðŸ˜§',
    'ðŸ˜®',
    'ðŸ˜²',
    'ðŸ¥±',
    'ðŸ˜´',
    'ðŸ¤¤',
    'ðŸ˜ª',
    'ðŸ˜µ',
    'ðŸ¤',
    'ðŸ¥´',
    'ðŸ¤¢',
    'ðŸ¤®',
    'ðŸ¤§',
    'ðŸ˜·',
    'ðŸ¤’',
    'ðŸ¤•',
    'ðŸ¤‘',
    'ðŸ¤ ',
    'ðŸ‘‹',
    'ðŸ¤š',
    'ðŸ–',
    'âœ‹',
    'ðŸ––',
    'ðŸ‘Œ',
    'ðŸ¤Œ',
    'ðŸ¤',
    'âœŒï¸',
    'ðŸ¤ž',
    'ðŸ¤Ÿ',
    'ðŸ¤˜',
    'ðŸ¤™',
    'ðŸ‘ˆ',
    'ðŸ‘‰',
    'ðŸ‘†',
    'ðŸ–•',
    'ðŸ‘‡',
    'â˜ï¸',
    'ðŸ‘',
    'ðŸ‘Ž',
    'âœŠ',
    'ðŸ‘Š',
    'ðŸ¤›',
    'ðŸ¤œ',
    'ðŸ‘',
    'ðŸ™Œ',
    'ðŸ‘',
    'ðŸ¤²',
    'ðŸ¤',
    'ðŸ™',
  ],
  Activities: [
    'âš½',
    'ðŸ€',
    'ðŸˆ',
    'âš¾',
    'ðŸ¥Ž',
    'ðŸŽ¾',
    'ðŸ',
    'ðŸ‰',
    'ðŸ¥',
    'ðŸŽ±',
    'ðŸª€',
    'ðŸ“',
    'ðŸ¸',
    'ðŸ’',
    'ðŸ‘',
    'ðŸ¥',
    'ðŸ',
    'ðŸªƒ',
    'ðŸ¥…',
    'â›³',
    'ðŸª',
    'ðŸ¹',
    'ðŸŽ£',
    'ðŸ¤¿',
    'ðŸ¥Š',
    'ðŸ¥‹',
    'ðŸŽ½',
    'ðŸ›¹',
    'ðŸ›¼',
    'ðŸ›·',
    'â›¸ï¸',
    'ðŸ¥Œ',
    'ðŸŽ¿',
    'â›·ï¸',
    'ðŸ‚',
    'ðŸª‚',
    'ðŸ‹ï¸',
    'ðŸ¤¸',
    'ðŸ¤¼',
    'ðŸ¤½',
    'ðŸ¤¾',
    'ðŸ¤¹',
    'ðŸ§˜',
    'ðŸŽª',
    'ðŸŽ­',
    'ðŸ©°',
    'ðŸŽ¨',
    'ðŸŽ¬',
    'ðŸŽ¤',
    'ðŸŽ§',
    'ðŸŽ¼',
    'ðŸŽ¹',
    'ðŸ¥',
    'ðŸª˜',
    'ðŸŽ·',
    'ðŸŽº',
    'ðŸª—',
    'ðŸŽ¸',
    'ðŸª•',
    'ðŸŽ»',
    'ðŸŽ²',
    'â™Ÿï¸',
    'ðŸŽ¯',
    'ðŸŽ³',
    'ðŸŽ®',
    'ðŸŽ°',
    'ðŸ§©',
  ],
  'Food & Drink': [
    'ðŸ‡',
    'ðŸˆ',
    'ðŸ‰',
    'ðŸŠ',
    'ðŸ‹',
    'ðŸŒ',
    'ðŸ',
    'ðŸ¥­',
    'ðŸŽ',
    'ðŸ',
    'ðŸ',
    'ðŸ‘',
    'ðŸ’',
    'ðŸ“',
    'ðŸ«',
    'ðŸ¥',
    'ðŸ…',
    'ðŸ«’',
    'ðŸ¥¥',
    'ðŸ¥‘',
    'ðŸ†',
    'ðŸ¥”',
    'ðŸ¥•',
    'ðŸŒ½',
    'ðŸŒ¶ï¸',
    'ðŸ«‘',
    'ðŸ¥’',
    'ðŸ¥¬',
    'ðŸ¥¦',
    'ðŸ§„',
    'ðŸ§…',
    'ðŸ„',
    'ðŸ¥œ',
    'ðŸŒ°',
    'ðŸž',
    'ðŸ¥',
    'ðŸ¥–',
    'ðŸ«“',
    'ðŸ¥¨',
    'ðŸ¥¯',
    'ðŸ¥ž',
    'ðŸ§‡',
    'ðŸ§€',
    'ðŸ–',
    'ðŸ—',
    'ðŸ¥©',
    'ðŸ¥“',
    'ðŸ”',
    'ðŸŸ',
    'ðŸ•',
    'ðŸŒ­',
    'ðŸ¥ª',
    'ðŸŒ®',
    'ðŸŒ¯',
    'ðŸ«”',
    'ðŸ¥™',
    'ðŸ§†',
    'ðŸ¥š',
    'ðŸ³',
    'ðŸ¥˜',
    'ðŸ²',
    'ðŸ«•',
    'ðŸ¥£',
    'ðŸ¥—',
    'ðŸ¿',
    'ðŸ§ˆ',
    'ðŸ§‚',
    'ðŸ¥«',
    'ðŸ±',
    'ðŸ˜',
    'ðŸ™',
    'ðŸš',
    'ðŸ›',
    'ðŸœ',
    'ðŸ',
    'ðŸ ',
    'ðŸ¢',
    'ðŸ£',
    'ðŸ¤',
    'ðŸ¥',
    'ðŸ¥®',
    'ðŸ¡',
    'ðŸ¥Ÿ',
    'ðŸ¥ ',
    'ðŸ¥¡',
    'ðŸ¦€',
    'ðŸ¦ž',
    'ðŸ¦',
    'ðŸ¦‘',
    'ðŸ¦ª',
    'ðŸ¦',
    'ðŸ§',
    'ðŸ¨',
    'ðŸ©',
    'ðŸª',
    'ðŸŽ‚',
    'ðŸ°',
    'ðŸ§',
    'ðŸ¥§',
    'ðŸ«',
    'ðŸ¬',
    'ðŸ­',
    'ðŸ®',
    'ðŸ¯',
    'â˜•',
    'ðŸ«–',
    'ðŸµ',
    'ðŸ¥¤',
    'ðŸ§ƒ',
    'ðŸ§‹',
    'ðŸ¶',
    'ðŸ¾',
    'ðŸ·',
    'ðŸ¸',
    'ðŸ¹',
    'ðŸº',
    'ðŸ»',
    'ðŸ¥‚',
    'ðŸ¥ƒ',
  ],
  'Travel & Places': [
    'ðŸš—',
    'ðŸš•',
    'ðŸš™',
    'ðŸšŒ',
    'ðŸšŽ',
    'ðŸŽï¸',
    'ðŸš“',
    'ðŸš‘',
    'ðŸš’',
    'ðŸš',
    'ðŸ›»',
    'ðŸšš',
    'ðŸš›',
    'ðŸšœ',
    'ðŸ¦¯',
    'ðŸ¦½',
    'ðŸ¦¼',
    'ðŸ›´',
    'ðŸš²',
    'ðŸ›µ',
    'ðŸï¸',
    'ðŸ›º',
    'ðŸš¨',
    'ðŸš”',
    'ðŸš',
    'ðŸš˜',
    'ðŸš–',
    'ðŸš¡',
    'ðŸš ',
    'ðŸšŸ',
    'ðŸšƒ',
    'ðŸš‹',
    'ðŸšž',
    'ðŸš',
    'ðŸš„',
    'ðŸš…',
    'ðŸšˆ',
    'ðŸš‚',
    'ðŸš†',
    'ðŸš‡',
    'ðŸšŠ',
    'ðŸš‰',
    'âœˆï¸',
    'ðŸ›«',
    'ðŸ›¬',
    'ðŸ›©ï¸',
    'ðŸ’º',
    'ðŸ›°ï¸',
    'ðŸš',
    'ðŸ›¶',
    'â›µ',
    'ðŸš¤',
    'ðŸ›¥ï¸',
    'ðŸ›³ï¸',
    'â›´ï¸',
    'ðŸš¢',
    'âš“',
    'â›½',
    'ðŸš§',
    'ðŸš¦',
    'ðŸš¥',
    'ðŸ—ºï¸',
    'ðŸ—¿',
    'ðŸ—½',
    'ðŸ—¼',
    'ðŸ°',
    'ðŸ¯',
    'ðŸŸï¸',
    'ðŸŽ¡',
    'ðŸŽ¢',
    'ðŸŽ ',
    'â›²',
    'â›±ï¸',
    'ðŸ–ï¸',
    'ðŸï¸',
    'ðŸœï¸',
    'ðŸŒ‹',
    'â›°ï¸',
    'ðŸ”ï¸',
    'ðŸ—»',
    'ðŸ•ï¸',
    'â›º',
    'ðŸ›–',
    'ðŸ ',
    'ðŸ¡',
    'ðŸ˜ï¸',
    'ðŸšï¸',
    'ðŸ—ï¸',
    'ðŸ­',
    'ðŸ¢',
    'ðŸ¬',
    'ðŸ£',
    'ðŸ¤',
    'ðŸ¥',
    'ðŸ¦',
    'ðŸ¨',
    'ðŸª',
    'ðŸ«',
    'ðŸ©',
    'ðŸ’’',
    'ðŸ›ï¸',
    'â›ª',
    'ðŸ•Œ',
    'ðŸ•',
    'ðŸ›•',
    'ðŸ•‹',
  ],
  Objects: [
    'âŒš',
    'ðŸ“±',
    'ðŸ“²',
    'ðŸ’»',
    'âŒ¨ï¸',
    'ðŸ–¥ï¸',
    'ðŸ–¨ï¸',
    'ðŸ–±ï¸',
    'ðŸ–²ï¸',
    'ðŸ•¹ï¸',
    'ðŸ—œï¸',
    'ðŸ’¾',
    'ðŸ’¿',
    'ðŸ“€',
    'ðŸ“¼',
    'ðŸ“·',
    'ðŸ“¸',
    'ðŸ“¹',
    'ðŸŽ¥',
    'ðŸ“½ï¸',
    'ðŸŽžï¸',
    'ðŸ“ž',
    'â˜Žï¸',
    'ðŸ“Ÿ',
    'ðŸ“ ',
    'ðŸ“º',
    'ðŸ“»',
    'ðŸŽ™ï¸',
    'ðŸŽšï¸',
    'ðŸŽ›ï¸',
    'ðŸ§­',
    'â±ï¸',
    'â²ï¸',
    'â°',
    'ðŸ•°ï¸',
    'âŒ›',
    'â³',
    'ðŸ“¡',
    'ðŸ”‹',
    'ðŸ”Œ',
    'ðŸ’¡',
    'ðŸ”¦',
    'ðŸ•¯ï¸',
    'ðŸª”',
    'ðŸ§¯',
    'ðŸ›¢ï¸',
    'ðŸ’¸',
    'ðŸ’µ',
    'ðŸ’´',
    'ðŸ’¶',
    'ðŸ’·',
    'ðŸª™',
    'ðŸ’°',
    'ðŸ’³',
    'ðŸ’Ž',
    'âš–ï¸',
    'ðŸªœ',
    'ðŸ§°',
    'ðŸª›',
    'ðŸ”§',
    'ðŸ”¨',
    'âš’ï¸',
    'ðŸ› ï¸',
    'â›ï¸',
    'ðŸªš',
    'ðŸ”©',
    'âš™ï¸',
    'ðŸª¤',
    'ðŸ§±',
    'â›“ï¸',
    'ðŸ§²',
    'ðŸ”«',
    'ðŸ’£',
    'ðŸ§¨',
    'ðŸª“',
    'ðŸ”ª',
    'ðŸ—¡ï¸',
    'âš”ï¸',
    'ðŸ›¡ï¸',
    'ðŸš¬',
    'âš°ï¸',
    'ðŸª¦',
    'âš±ï¸',
    'ðŸº',
    'ðŸ”®',
    'ðŸ“¿',
    'ðŸ§¿',
    'ðŸ’ˆ',
    'âš—ï¸',
    'ðŸ”­',
    'ðŸ”¬',
    'ðŸ•³ï¸',
    'ðŸ©¹',
    'ðŸ©º',
    'ðŸ’Š',
    'ðŸ’‰',
    'ðŸ©¸',
    'ðŸ§¬',
    'ðŸ¦ ',
    'ðŸ§«',
    'ðŸ§ª',
    'ðŸŒ¡ï¸',
    'ðŸ§¹',
    'ðŸª ',
    'ðŸ§º',
    'ðŸ§»',
    'ðŸš½',
    'ðŸš°',
    'ðŸš¿',
    'ðŸ›',
    'ðŸ›€',
    'ðŸ§¼',
    'ðŸª¥',
    'ðŸª’',
    'ðŸ§½',
    'ðŸª£',
    'ðŸ§´',
    'ðŸ›Žï¸',
    'ðŸ”‘',
    'ðŸ—ï¸',
    'ðŸšª',
    'ðŸª‘',
    'ðŸ›‹ï¸',
    'ðŸ›ï¸',
    'ðŸ›Œ',
    'ðŸ§¸',
    'ðŸª†',
    'ðŸ–¼ï¸',
    'ðŸªž',
    'ðŸªŸ',
    'ðŸ›ï¸',
    'ðŸ›’',
    'ðŸŽ',
    'ðŸŽˆ',
    'ðŸŽ',
    'ðŸŽ€',
    'ðŸª„',
    'ðŸª…',
    'ðŸŽŠ',
    'ðŸŽ‰',
    'ðŸª©',
    'ðŸŽŽ',
    'ðŸ®',
    'ðŸŽ',
    'ðŸ§§',
    'âœ‰ï¸',
    'ðŸ“©',
    'ðŸ“¨',
    'ðŸ“§',
    'ðŸ’Œ',
    'ðŸ“¥',
    'ðŸ“¤',
    'ðŸ“¦',
    'ðŸ·ï¸',
    'ðŸª§',
    'ðŸ“ª',
    'ðŸ“«',
    'ðŸ“¬',
    'ðŸ“­',
    'ðŸ“®',
    'ðŸ“¯',
    'ðŸ“œ',
    'ðŸ“ƒ',
    'ðŸ“„',
    'ðŸ“‘',
    'ðŸ§¾',
    'ðŸ“Š',
    'ðŸ“ˆ',
    'ðŸ“‰',
    'ðŸ—’ï¸',
    'ðŸ—“ï¸',
    'ðŸ“†',
    'ðŸ“…',
    'ðŸ—‘ï¸',
    'ðŸ“‡',
    'ðŸ—ƒï¸',
    'ðŸ—³ï¸',
    'ðŸ—„ï¸',
    'ðŸ“‹',
    'ðŸ“',
    'ðŸ“‚',
    'ðŸ—‚ï¸',
    'ðŸ—žï¸',
    'ðŸ“°',
    'ðŸ““',
    'ðŸ“”',
    'ðŸ“’',
    'ðŸ“•',
    'ðŸ“—',
    'ðŸ“˜',
    'ðŸ“™',
    'ðŸ“š',
    'ðŸ“–',
    'ðŸ”–',
    'ðŸ§·',
    'ðŸ”—',
    'ðŸ“Ž',
    'ðŸ–‡ï¸',
    'ðŸ“',
    'ðŸ“',
    'ðŸ§®',
    'ðŸ“Œ',
    'ðŸ“',
    'âœ‚ï¸',
    'ðŸ–Šï¸',
    'ðŸ–‹ï¸',
    'âœ’ï¸',
    'ðŸ–Œï¸',
    'ðŸ–ï¸',
    'ðŸ“',
    'âœï¸',
    'ðŸ”',
    'ðŸ”Ž',
    'ðŸ”',
    'ðŸ”',
    'ðŸ”’',
    'ðŸ”“',
  ],
  Symbols: [
    'ðŸ’¯',
    'ðŸ”¢',
    'ðŸ”£',
    'ðŸ”¤',
    'ðŸ”¡',
    'ðŸ” ',
    'ðŸ†—',
    'ðŸ†•',
    'ðŸ†™',
    'ðŸ†’',
    'ðŸ†“',
    'ðŸ†–',
    'ðŸŽ¦',
    'ðŸ“¶',
    'ðŸˆ',
    'ðŸˆ¯',
    'ðŸˆ³',
    'ðŸˆµ',
    'ðŸˆ´',
    'ðŸˆ²',
    'ðŸ‰',
    'ðŸˆ¹',
    'ðŸˆº',
    'ðŸˆ¶',
    'ðŸˆš',
    'ðŸš»',
    'ðŸš¹',
    'ðŸšº',
    'ðŸš¼',
    'ðŸš¾',
    'ðŸš°',
    'ðŸš®',
    'ðŸ…¿ï¸',
    'â™¿',
    'ðŸš­',
    'ðŸ›—',
    'ðŸš«',
    'ðŸ”ž',
    'ðŸ“µ',
    'ðŸš¯',
    'ðŸš±',
    'ðŸš³',
    'ðŸš·',
    'ðŸš¸',
    'â›”',
    'âœ…',
    'â˜‘ï¸',
    'âœ”ï¸',
    'âœ–ï¸',
    'âŒ',
    'âŽ',
    'âž•',
    'âž–',
    'âž—',
    'âž°',
    'âž¿',
    'ã€½ï¸',
    'âœ³ï¸',
    'âœ´ï¸',
    'â‡ï¸',
    'â€¼ï¸',
    'â‰ï¸',
    'â“',
    'â”',
    'â•',
    'â—',
    'ã€°ï¸',
    'Â©ï¸',
    'Â®ï¸',
    'â„¢ï¸',
    '#ï¸âƒ£',
    '*ï¸âƒ£',
    '0ï¸âƒ£',
    '1ï¸âƒ£',
    '2ï¸âƒ£',
    '3ï¸âƒ£',
    '4ï¸âƒ£',
    '5ï¸âƒ£',
    '6ï¸âƒ£',
    '7ï¸âƒ£',
    '8ï¸âƒ£',
    '9ï¸âƒ£',
    'ðŸ”Ÿ',
    'ðŸ”´',
    'ðŸŸ ',
    'ðŸŸ¡',
    'ðŸŸ¢',
    'ðŸ”µ',
    'ðŸŸ£',
    'ðŸŸ¤',
    'âš«',
    'âšª',
    'ðŸŸ¥',
    'ðŸŸ§',
    'ðŸŸ¨',
    'ðŸŸ©',
    'ðŸŸ¦',
    'ðŸŸª',
    'ðŸŸ«',
    'â¬›',
    'â¬œ',
    'â—¼ï¸',
    'â—»ï¸',
    'â—¾',
    'â—½',
    'â–ªï¸',
    'â–«ï¸',
    'ðŸ”¶',
    'ðŸ”·',
    'ðŸ”¸',
    'ðŸ”¹',
    'ðŸ”º',
    'ðŸ”»',
    'ðŸ’ ',
    'ðŸ”˜',
    'ðŸ”³',
    'ðŸ”²',
    'â­',
    'ðŸŒŸ',
    'âœ¨',
    'âš¡',
    'ðŸ’¥',
    'ðŸ”¥',
    'ðŸ’«',
    'â­•',
    'â¤ï¸',
    'ðŸ§¡',
    'ðŸ’›',
    'ðŸ’š',
    'ðŸ’™',
    'ðŸ’œ',
    'ðŸ¤Ž',
    'ðŸ–¤',
    'ðŸ¤',
    'ðŸ’”',
    'â¤ï¸â€ðŸ”¥',
    'â¤ï¸â€ðŸ©¹',
    'ðŸ’•',
    'ðŸ’ž',
    'ðŸ’“',
    'ðŸ’—',
    'ðŸ’–',
    'ðŸ’˜',
    'ðŸ’',
  ],
};

export function EmojiPicker({ value, onChange, trigger }: EmojiPickerProps) {
  const [search, setSearch] = useState('');
  const [open, setOpen] = useState(false);

  const filteredEmojis = useMemo(() => {
    if (!search) {
return EMOJI_CATEGORIES;
}

    const filtered: Record<string, string[]> = {};
    Object.entries(EMOJI_CATEGORIES).forEach(([category, emojis]) => {
      const matches = emojis.filter(emoji =>
        emoji.toLowerCase().includes(search.toLowerCase()),
      );
      if (matches.length > 0) {
        filtered[category] = matches;
      }
    });
    return filtered;
  }, [search]);

  const handleSelect = (emoji: string) => {
    onChange(emoji);
    setOpen(false);
    setSearch('');
  };

  return (
    <Popover open={open} onOpenChange={setOpen}>
      <PopoverTrigger asChild>
        {trigger || (
          <Button variant="outline" size="sm" className="h-10 w-16 text-2xl p-0">
            {value || 'ðŸ˜€'}
          </Button>
        )}
      </PopoverTrigger>
      <PopoverContent className="w-80 p-0" align="start">
        <div className="p-3 border-b">
          <div className="relative">
            <Search className="absolute left-3 top-2.5 h-4 w-4 text-muted-foreground" />
            <input
              type="text"
              placeholder="Search emojis..."
              value={search}
              onChange={e => setSearch(e.target.value)}
              className="w-full pl-9 pr-3 py-2 text-sm border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
            />
          </div>
        </div>
        <ScrollArea className="h-72">
          <div className="p-3 space-y-4">
            {Object.entries(filteredEmojis).map(([category, emojis]) => (
              <div key={category}>
                <h4 className="text-xs font-semibold text-muted-foreground mb-2">
                  {category}
                </h4>
                <div className="grid grid-cols-8 gap-1">
                  {emojis.map(emoji => (
                    <button
                      key={emoji}
                      onClick={() => handleSelect(emoji)}
                      className={cn(
                        'h-8 w-8 flex items-center justify-center text-xl rounded hover:bg-accent transition-colors',
                        value === emoji && 'bg-accent ring-2 ring-primary',
                      )}
                      type="button"
                    >
                      {emoji}
                    </button>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </ScrollArea>
      </PopoverContent>
    </Popover>
  );
}
