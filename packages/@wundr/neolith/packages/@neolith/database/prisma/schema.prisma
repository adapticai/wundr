generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model account {
  id                String   @id @default(cuid())
  userId            String   @map("user_id")
  type              String
  provider          String
  providerAccountId String   @map("provider_account_id")
  refreshToken      String?  @map("refresh_token")
  accessToken       String?  @map("access_token")
  expiresAt         Int?     @map("expires_at")
  tokenType         String?  @map("token_type")
  scope             String?
  idToken           String?  @map("id_token")
  sessionState      String?  @map("session_state")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  user              user     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@map("accounts")
}

model backlogItem {
  id        String   @id @default(cuid())
  position  Int      @default(0)
  backlogId String   @map("backlog_id")
  taskId    String   @map("task_id")
  addedAt   DateTime @default(now()) @map("added_at")
  backlog   backlog  @relation(fields: [backlogId], references: [id], onDelete: Cascade)
  task      task     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([backlogId, taskId])
  @@index([backlogId])
  @@index([position])
  @@index([taskId])
  @@map("backlog_items")
}

model backlog {
  id             String        @id @default(cuid())
  name           String
  description    String?
  status         String        @default("active")
  priority       Int           @default(0)
  metadata       Json          @default("{}")
  orchestratorId String        @map("vp_id")
  workspaceId    String        @map("workspace_id")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
  backlogItems   backlogItem[]
  orchestrator   orchestrator  @relation(fields: [orchestratorId], references: [id], onDelete: Cascade) // Orchestrator that owns this backlog
  workspace      workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([orchestratorId, name])
  @@index([priority])
  @@index([status])
  @@index([orchestratorId])
  @@index([workspaceId])
  @@map("backlogs")
}

model channelMember {
  id                     String      @id @default(cuid())
  role                   ChannelRole @default(MEMBER)
  channelId              String      @map("channel_id")
  userId                 String      @map("user_id")
  joinedAt               DateTime    @default(now()) @map("joined_at")
  lastReadAt             DateTime?   @map("last_read_at")
  leftAt                 DateTime?   @map("left_at")
  isStarred              Boolean     @default(false) @map("is_starred")
  notificationPreference String      @default("all") @map("notification_preference")
  channel                channel     @relation(fields: [channelId], references: [id], onDelete: Cascade)
  user                   user        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([channelId, userId])
  @@index([channelId])
  @@index([leftAt])
  @@index([userId])
  @@index([isStarred])
  @@map("channel_members")
}

model channel {
  id               String            @id @default(cuid())
  name             String
  slug             String
  description      String?
  topic            String?
  type             ChannelType       @default(PUBLIC)
  isArchived       Boolean           @default(false) @map("is_archived")
  settings         Json              @default("{}")
  workspaceId      String            @map("workspace_id")
  createdById      String?           @map("created_by_id")
  createdAt        DateTime          @default(now()) @map("created_at")
  updatedAt        DateTime          @updatedAt @map("updated_at")
  channelMembers   channelMember[]
  createdBy        user?             @relation(fields: [createdById], references: [id])
  workspace        workspace         @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  messages         message[]
  tasks            task[]
  channelTemplates channelTemplate[]

  @@unique([workspaceId, slug])
  @@index([isArchived])
  @@index([type])
  @@index([workspaceId])
  @@map("channels")
}

model channelTemplate {
  id          String   @id @default(cuid())
  name        String
  description String?
  content     String
  icon        String?
  metadata    Json     @default("{}")
  isSystem    Boolean  @default(false) @map("is_system")
  channelId   String   @map("channel_id")
  createdById String   @map("created_by_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  channel     channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)
  createdBy   user     @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@unique([channelId, name])
  @@index([channelId])
  @@index([createdById])
  @@index([isSystem])
  @@map("channel_templates")
}

model daemonCredential {
  id             String       @id @default(cuid())
  apiKey         String       @unique @map("api_key")
  apiSecretHash  String       @map("api_secret_hash")
  hostname       String?
  version        String?
  capabilities   String[]
  metadata       Json?
  isActive       Boolean      @default(true) @map("is_active")
  orchestratorId String       @map("vp_id")
  workspaceId    String       @map("workspace_id")
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  expiresAt      DateTime?    @map("expires_at")
  lastUsedAt     DateTime?    @map("last_used_at")
  orchestrator   orchestrator @relation(fields: [orchestratorId], references: [id], onDelete: Cascade) // Orchestrator these credentials authenticate
  workspace      workspace    @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([apiKey])
  @@index([isActive])
  @@index([orchestratorId])
  @@index([workspaceId])
  @@map("daemon_credentials")
}

model discipline {
  id             String         @id @default(cuid())
  name           String
  description    String?
  color          String?
  icon           String?
  organizationId String         @map("organization_id")
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @updatedAt @map("updated_at")
  organization   organization   @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  orchestrators  orchestrator[] // Orchestrators associated with this discipline

  @@unique([organizationId, name])
  @@index([name])
  @@index([organizationId])
  @@map("disciplines")
}

model file {
  id                 String              @id @default(cuid())
  filename           String
  originalName       String              @map("original_name")
  mimeType           String              @map("mime_type")
  size               BigInt
  s3Key              String              @map("s3_key")
  s3Bucket           String              @map("s3_bucket")
  thumbnailUrl       String?             @map("thumbnail_url")
  status             FileStatus          @default(PENDING)
  metadata           Json                @default("{}")
  workspaceId        String              @map("workspace_id")
  uploadedById       String              @map("uploaded_by_id")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  uploadedBy         user                @relation(fields: [uploadedById], references: [id], onDelete: Cascade)
  workspace          workspace           @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  messageAttachments messageAttachment[]
  savedItems         savedItem[]

  @@index([mimeType])
  @@index([status])
  @@index([uploadedById])
  @@index([workspaceId])
  @@map("files")
}

model messageAttachment {
  id        String   @id @default(cuid())
  messageId String   @map("message_id")
  fileId    String   @map("file_id")
  createdAt DateTime @default(now()) @map("created_at")
  file      file     @relation(fields: [fileId], references: [id], onDelete: Cascade)
  message   message  @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@unique([messageId, fileId])
  @@index([fileId])
  @@index([messageId])
  @@map("message_attachments")
}

model message {
  id                 String              @id @default(cuid())
  content            String
  type               MessageType         @default(TEXT)
  metadata           Json                @default("{}")
  isEdited           Boolean             @default(false) @map("is_edited")
  isDeleted          Boolean             @default(false) @map("is_deleted")
  editedAt           DateTime?           @map("edited_at")
  deletedAt          DateTime?           @map("deleted_at")
  channelId          String              @map("channel_id")
  authorId           String              @map("author_id")
  parentId           String?             @map("parent_id")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  messageAttachments messageAttachment[]
  author             user                @relation(fields: [authorId], references: [id], onDelete: Cascade)
  channel            channel             @relation(fields: [channelId], references: [id], onDelete: Cascade)
  parent             message?            @relation("messageToMessage", fields: [parentId], references: [id])
  replies            message[]           @relation("messageToMessage")
  reactions          reaction[]
  savedItems         savedItem[]

  @@index([authorId])
  @@index([channelId])
  @@index([createdAt])
  @@index([deletedAt])
  @@index([parentId])
  @@index([type])
  @@map("messages")
}

model notification {
  id           String               @id @default(cuid())
  title        String
  body         String
  type         NotificationType
  priority     NotificationPriority @default(NORMAL)
  resourceId   String?              @map("resource_id")
  resourceType String?              @map("resource_type")
  actionUrl    String?              @map("action_url")
  metadata     Json                 @default("{}")
  read         Boolean              @default(false)
  readAt       DateTime?            @map("read_at")
  archived     Boolean              @default(false)
  expiresAt    DateTime?            @map("expires_at")
  userId       String               @map("user_id")
  createdAt    DateTime             @default(now()) @map("created_at")
  updatedAt    DateTime             @updatedAt @map("updated_at")
  user         user                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([priority])
  @@index([read])
  @@index([type])
  @@index([userId])
  @@map("notifications")
}

model organizationMember {
  id             String           @id @default(cuid())
  role           OrganizationRole @default(MEMBER)
  organizationId String           @map("organization_id")
  userId         String           @map("user_id")
  joinedAt       DateTime         @default(now()) @map("joined_at")
  organization   organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           user             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([organizationId, userId])
  @@index([organizationId])
  @@index([userId])
  @@map("organization_members")
}

model organization {
  id                  String               @id @default(cuid())
  name                String
  slug                String               @unique
  avatarUrl           String?              @map("avatar_url")
  description         String?
  settings            Json                 @default("{}")
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  disciplines         discipline[]
  organizationMembers organizationMember[]
  orchestrators       orchestrator[] // Orchestrators in this organization
  workspaces          workspace[]

  @@index([slug])
  @@map("organizations")
}

model pushSubscription {
  id                 String       @id @default(cuid())
  token              String       @unique
  platform           PushPlatform
  userAgent          String?      @map("user_agent")
  deviceName         String?      @map("device_name")
  deviceModel        String?      @map("device_model")
  appVersion         String?      @map("app_version")
  active             Boolean      @default(true)
  deactivatedAt      DateTime?    @map("deactivated_at")
  deactivationReason String?      @map("deactivation_reason")
  failureCount       Int          @default(0) @map("failure_count")
  lastFailureAt      DateTime?    @map("last_failure_at")
  lastFailureReason  String?      @map("last_failure_reason")
  userId             String       @map("user_id")
  createdAt          DateTime     @default(now()) @map("created_at")
  updatedAt          DateTime     @updatedAt @map("updated_at")
  lastActiveAt       DateTime?    @map("last_active_at")
  user               user         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([active])
  @@index([platform])
  @@index([token])
  @@index([userId])
  @@map("push_subscriptions")
}

model reaction {
  id        String   @id @default(cuid())
  emoji     String
  messageId String   @map("message_id")
  userId    String   @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")
  message   message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      user     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId, emoji])
  @@index([messageId])
  @@index([userId])
  @@map("reactions")
}

model session {
  id           String   @id @default(cuid())
  sessionToken String   @unique @map("session_token")
  expires      DateTime
  userId       String   @map("user_id")
  user         user     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([sessionToken])
  @@index([userId])
  @@map("sessions")
}

model task {
  id             String        @id @default(cuid())
  title          String
  description    String?
  priority       TaskPriority  @default(MEDIUM)
  status         TaskStatus    @default(TODO)
  dueDate        DateTime?     @map("due_date")
  estimatedHours Int?          @map("estimated_hours")
  tags           String[]      @default([])
  metadata       Json          @default("{}")
  dependsOn      String[]      @default([]) @map("depends_on")
  orchestratorId String        @map("vp_id")
  workspaceId    String        @map("workspace_id")
  channelId      String?       @map("channel_id")
  createdById    String        @map("created_by_id")
  assignedToId   String?       @map("assigned_to_id")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
  completedAt    DateTime?     @map("completed_at")
  backlogItems   backlogItem[]
  assignedTo     user?         @relation("taskAssignedTo", fields: [assignedToId], references: [id])
  channel        channel?      @relation(fields: [channelId], references: [id])
  createdBy      user          @relation("taskCreatedBy", fields: [createdById], references: [id])
  orchestrator   orchestrator  @relation(fields: [orchestratorId], references: [id], onDelete: Cascade) // Orchestrator responsible for this task
  workspace      workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([assignedToId])
  @@index([channelId])
  @@index([createdAt])
  @@index([createdById])
  @@index([dueDate])
  @@index([priority])
  @@index([status])
  @@index([orchestratorId])
  @@index([workspaceId])
  @@map("tasks")
}

model user {
  id                     String               @id @default(cuid())
  email                  String               @unique
  name                   String?
  displayName            String?              @map("display_name")
  avatarUrl              String?              @map("avatar_url")
  bio                    String?
  status                 UserStatus           @default(PENDING)
  isOrchestrator         Boolean              @default(false) @map("is_vp") // Flag indicating if user is an Orchestrator
  orchestratorConfig     Json?                @map("vp_config") // Orchestrator configuration settings
  preferences            Json                 @default("{}")
  currentWorkspaceSlug   String?              @map("current_workspace_slug") // User's last-visited workspace slug
  createdAt              DateTime             @default(now()) @map("created_at")
  updatedAt              DateTime             @updatedAt @map("updated_at")
  lastActiveAt           DateTime?            @map("last_active_at")
  emailVerified          DateTime?            @map("email_verified")
  accounts               account[]
  channelMembers         channelMember[]
  channels               channel[]
  channelTemplates       channelTemplate[]
  files                  file[]
  messages               message[]
  notifications          notification[]
  organizationMembers    organizationMember[]
  pushSubscriptions      pushSubscription[]
  reactions              reaction[]
  sessions               session[]
  tasksAssignedTo        task[]               @relation("taskAssignedTo")
  tasksCreatedBy         task[]               @relation("taskCreatedBy")
  orchestrator           orchestrator? // Associated Orchestrator profile (if user is an Orchestrator)
  workspaceMembers       workspaceMember[]
  webhooks                webhook[]
  savedItems              savedItem[]
  charterVersionsCreated  charterVersion[]
  promptTemplates         promptTemplate[]
  promptTemplateStars     promptTemplateStar[]
  promptTemplateVersions  promptTemplateVersion[]
  aiFeedback              aiFeedback[]

  @@index([email])
  @@index([status])
  @@map("users")
}

model verificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

/// Orchestrator - AI-powered autonomous agent for task execution and workflow automation
model orchestrator {
  id                   String               @id @default(cuid())
  discipline           String // Orchestrator's area of expertise (e.g., engineering, product, design)
  role                 String // Specific role within the discipline
  capabilities         Json                 @default("[]") // List of capabilities and skills the Orchestrator possesses
  daemonEndpoint       String?              @map("daemon_endpoint") // Endpoint for the daemon process running this Orchestrator
  status               OrchestratorStatus   @default(OFFLINE) // Current operational status of the Orchestrator
  userId               String               @unique @map("user_id") // Associated user account for this Orchestrator
  organizationId       String               @map("organization_id")
  workspaceId          String?              @map("workspace_id")
  disciplineId         String?              @map("discipline_id")
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")
  backlogs             backlog[]
  daemonCredentials    daemonCredential[]
  tasks                task[]
  config               orchestratorConfig?
  disciplineRef        discipline?          @relation(fields: [disciplineId], references: [id])
  organization         organization         @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user                 user                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  orchestratorMemories orchestratorMemory[]
  sessionManagers      sessionManager[]
  charterVersions      charterVersion[]
  tokenUsage           TokenUsage[]
  budgetConfig         BudgetConfig?
  budgetAlerts         BudgetAlert[]
  federationRegistry   FederationRegistry?

  @@index([disciplineId])
  @@index([discipline])
  @@index([organizationId])
  @@index([status])
  @@index([workspaceId])
  @@map("vps")
}

/// OrchestratorConfig - Configuration settings for an Orchestrator
model orchestratorConfig {
  id                  String       @id @default(cuid())
  orchestratorId      String       @unique @map("vp_id")
  autoReply           Boolean      @default(true) @map("auto_reply")
  replyDelay          Int          @default(0) @map("reply_delay")
  maxDailyActions     Int?         @map("max_daily_actions")
  maxHourlyActions    Int?         @map("max_hourly_actions")
  triggers            Json         @default("[]")
  watchedChannels     String[]     @default([]) @map("watched_channels")
  mentionOnly         Boolean      @default(false) @map("mention_only")
  keywordTriggers     String[]     @default([]) @map("keyword_triggers")
  enabledCapabilities Json         @default("{}") @map("enabled_capabilities")
  capabilityLimits    Json         @default("{}") @map("capability_limits")
  responseTemplates   Json         @default("{}") @map("response_templates")
  customPrompts       Json         @default("{}") @map("custom_prompts")
  llmProvider         String       @default("anthropic") @map("llm_provider")
  llmModel            String       @default("claude-3-5-sonnet-20241022") @map("llm_model")
  temperature         Float        @default(0.7)
  maxTokens           Int          @default(4096) @map("max_tokens")
  integrationConfig   Json         @default("{}") @map("integration_config")
  webhookUrls         String[]     @default([]) @map("webhook_urls")
  assignedWorkspaces  String[]     @default([]) @map("assigned_workspaces")
  adminOverrides      Json         @default("{}") @map("admin_overrides")
  isLocked            Boolean      @default(false) @map("is_locked")
  createdAt           DateTime     @default(now()) @map("created_at")
  updatedAt           DateTime     @updatedAt @map("updated_at")
  orchestrator        orchestrator @relation(fields: [orchestratorId], references: [id], onDelete: Cascade)

  @@index([orchestratorId])
  @@map("vp_configs")
}

model workflowExecution {
  id           String                  @id @default(cuid())
  status       WorkflowExecutionStatus @default(PENDING)
  triggeredBy  String                  @map("triggered_by")
  triggerType  String                  @map("trigger_type")
  triggerData  Json?                   @map("trigger_data")
  steps        Json                    @default("[]")
  error        String?
  startedAt    DateTime                @default(now()) @map("started_at")
  completedAt  DateTime?               @map("completed_at")
  durationMs   Int?                    @map("duration_ms")
  isSimulation Boolean                 @default(false) @map("is_simulation")
  workflowId   String                  @map("workflow_id")
  workspaceId  String                  @map("workspace_id")
  workflow     workflow                @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([isSimulation])
  @@index([startedAt])
  @@index([status])
  @@index([triggeredBy])
  @@index([workflowId])
  @@index([workspaceId])
  @@map("workflow_executions")
}

model workflow {
  id                 String              @id @default(cuid())
  name               String
  description        String?
  trigger            Json
  actions            Json
  status             WorkflowStatus      @default(DRAFT)
  tags               String[]            @default([])
  metadata           Json?
  executionCount     Int                 @default(0) @map("execution_count")
  successCount       Int                 @default(0) @map("success_count")
  failureCount       Int                 @default(0) @map("failure_count")
  workspaceId        String              @map("workspace_id")
  createdBy          String              @map("created_by")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  lastExecutedAt     DateTime?           @map("last_executed_at")
  workflowExecutions workflowExecution[]
  workspace          workspace           @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, name])
  @@index([createdAt])
  @@index([createdBy])
  @@index([status])
  @@index([workspaceId])
  @@map("workflows")
}

model workspaceMember {
  id          String        @id @default(cuid())
  role        WorkspaceRole @default(MEMBER)
  workspaceId String        @map("workspace_id")
  userId      String        @map("user_id")
  joinedAt    DateTime      @default(now()) @map("joined_at")
  settings    Json          @default("{}") // Workspace-specific user settings
  user        user          @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace   workspace     @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([workspaceId, userId])
  @@index([userId])
  @@index([workspaceId])
  @@map("workspace_members")
}

model workspace {
  id                String              @id @default(cuid())
  name              String
  slug              String
  description       String?
  avatarUrl         String?             @map("avatar_url")
  visibility        WorkspaceVisibility @default(PRIVATE)
  settings          Json                @default("{}")
  organizationId    String              @map("organization_id")
  createdAt         DateTime            @default(now()) @map("created_at")
  updatedAt         DateTime            @updatedAt @map("updated_at")
  backlogs          backlog[]
  channels          channel[]
  daemonCredentials daemonCredential[]
  files             file[]
  tasks             task[]
  workflows         workflow[]
  workspaceMembers  workspaceMember[]
  integrations      integration[]
  deployments       deployment[]
  agents            agent[]
  organization      organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  webhooks          webhook[]
  savedItems        savedItem[]
  aiFeedback        aiFeedback[]

  @@unique([organizationId, slug])
  @@index([organizationId])
  @@index([slug])
  @@map("workspaces")
}

enum ChannelRole {
  OWNER
  ADMIN
  MEMBER
}

enum ChannelType {
  PUBLIC
  PRIVATE
  DM
  HUDDLE
}

enum FileStatus {
  PENDING
  PROCESSING
  READY
  FAILED
}

enum MessageType {
  TEXT
  FILE
  SYSTEM
  COMMAND
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum NotificationType {
  MESSAGE
  MENTION
  THREAD_REPLY
  CALL
  CHANNEL_INVITE
  ORGANIZATION_UPDATE
  SYSTEM
}

enum OrganizationRole {
  OWNER
  ADMIN
  MEMBER
}

enum PushPlatform {
  web
  ios
  android
}

enum TaskPriority {
  CRITICAL
  HIGH
  MEDIUM
  LOW
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  BLOCKED
  DONE
  CANCELLED
}

enum UserStatus {
  ACTIVE
  INACTIVE
  PENDING
  SUSPENDED
}

/// Orchestrator operational status enumeration
enum OrchestratorStatus {
  ONLINE // Orchestrator is active and available for tasks
  OFFLINE // Orchestrator is not currently running
  BUSY // Orchestrator is actively processing tasks
  AWAY // Orchestrator is paused or temporarily unavailable

  @@map("VPStatus")
}

enum WorkflowExecutionStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
  TIMEOUT
}

enum WorkflowStatus {
  ACTIVE
  INACTIVE
  DRAFT
  ARCHIVED
}

enum WorkspaceRole {
  OWNER
  ADMIN
  MEMBER
  GUEST
}

enum WorkspaceVisibility {
  PUBLIC
  PRIVATE
  INTERNAL
}

// =============================================================================
// Integration Models (Phase 8 - Workspace Integrations)
// =============================================================================

/// Integration status enumeration
enum IntegrationStatus {
  ACTIVE
  INACTIVE
  PENDING
  ERROR
  REVOKED
}

/// Integration provider enumeration
enum IntegrationProvider {
  SLACK
  GITHUB
  GITLAB
  JIRA
  LINEAR
  NOTION
  GOOGLE_DRIVE
  MICROSOFT_365
  ZAPIER
  CUSTOM
}

/// Integration - Third-party service integration configuration
model integration {
  id           String              @id @default(cuid())
  name         String
  description  String?
  provider     IntegrationProvider
  status       IntegrationStatus   @default(PENDING)
  accessToken  String?             @map("access_token") @db.Text
  refreshToken String?             @map("refresh_token") @db.Text
  expiresAt    DateTime?           @map("expires_at")
  config       Json                @default("{}")
  syncEnabled  Boolean             @default(false) @map("sync_enabled")
  lastSyncAt   DateTime?           @map("last_sync_at")
  syncError    String?             @map("sync_error")
  workspaceId  String              @map("workspace_id")
  connectedBy  String              @map("connected_by")
  createdAt    DateTime            @default(now()) @map("created_at")
  updatedAt    DateTime            @updatedAt @map("updated_at")
  connectedAt  DateTime?           @map("connected_at")
  workspace    workspace           @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId])
  @@index([provider])
  @@index([status])
  @@index([connectedBy])
  @@index([createdAt])
  @@map("integrations")
}

/// Webhook status
enum WebhookStatus {
  ACTIVE
  INACTIVE
  FAILED
}

/// Webhook delivery status
enum WebhookDeliveryStatus {
  PENDING
  SUCCESS
  FAILED
  RETRYING
}

/// Webhook - Outgoing webhook configuration
model webhook {
  id            String            @id @default(cuid())
  name          String
  url           String
  secret        String?
  events        String[]
  status        WebhookStatus     @default(ACTIVE)
  headers       Json              @default("{}")
  retryAttempts Int               @default(3) @map("retry_attempts")
  timeout       Int               @default(30000)
  workspaceId   String            @map("workspace_id")
  createdById   String            @map("created_by_id")
  createdAt     DateTime          @default(now()) @map("created_at")
  updatedAt     DateTime          @updatedAt @map("updated_at")
  workspace     workspace         @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  createdBy     user              @relation(fields: [createdById], references: [id])
  deliveries    webhookDelivery[]

  @@index([workspaceId])
  @@index([status])
  @@index([createdById])
  @@map("webhooks")
}

/// WebhookDelivery - Webhook delivery attempt record
model webhookDelivery {
  id             String                @id @default(cuid())
  webhookId      String                @map("webhook_id")
  event          String
  payload        Json
  status         WebhookDeliveryStatus @default(PENDING)
  responseStatus Int?                  @map("response_status")
  responseBody   String?               @map("response_body") @db.Text
  error          String?               @db.Text
  attemptCount   Int                   @default(0) @map("attempt_count")
  nextRetryAt    DateTime?             @map("next_retry_at")
  createdAt      DateTime              @default(now()) @map("created_at")
  completedAt    DateTime?             @map("completed_at")
  webhook        webhook               @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId])
  @@index([status])
  @@index([createdAt])
  @@map("webhook_deliveries")
}

/// OrchestratorMemory - Memory entries for Orchestrator conversation context and learned knowledge
model orchestratorMemory {
  id             String       @id @default(cuid())
  orchestratorId String       @map("vp_id") // Reference to the Orchestrator
  memoryType     String       @map("memory_type") // Type of memory (e.g., conversation, learned_fact, procedure)
  content        String       @db.Text // The actual memory content
  embedding      Json? // Vector embedding for semantic search
  metadata       Json         @default("{}") // Additional context and metadata
  importance     Float        @default(0.5) // Importance score for memory retention (0.0 to 1.0)
  expiresAt      DateTime?    @map("expires_at") // Optional expiration for temporary memories
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  orchestrator   orchestrator @relation(fields: [orchestratorId], references: [id], onDelete: Cascade)

  @@index([orchestratorId])
  @@index([memoryType])
  @@index([importance])
  @@index([createdAt])
  @@map("vp_memories")
}

// =============================================================================
// Export Job Models (Async Export System)
// =============================================================================

/// Export job status enumeration
enum ExportStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

/// Export format enumeration
enum ExportFormat {
  JSON
  CSV
}

/// ExportJob - Background job for large workspace data exports
model exportJob {
  id          String       @id @default(cuid())
  workspaceId String       @map("workspace_id")
  type        String // channels, messages, members, workflows, all
  format      ExportFormat @default(JSON)
  status      ExportStatus @default(PENDING)
  fileUrl     String?      @map("file_url")
  fileSize    BigInt?      @map("file_size")
  recordCount Int?         @map("record_count")
  error       String?      @db.Text
  progress    Int          @default(0)
  startDate   DateTime?    @map("start_date")
  endDate     DateTime?    @map("end_date")
  requestedBy String       @map("requested_by")
  createdAt   DateTime     @default(now()) @map("created_at")
  startedAt   DateTime?    @map("started_at")
  completedAt DateTime?    @map("completed_at")

  @@index([workspaceId])
  @@index([status])
  @@index([requestedBy])
  @@index([createdAt])
  @@map("export_jobs")
}

// =============================================================================
// Deployment Models (CI/CD & Deployment Management)
// =============================================================================

/// Deployment status enumeration
enum DeploymentStatus {
  PENDING
  BUILDING
  DEPLOYING
  ACTIVE
  FAILED
  STOPPED
}

/// Deployment environment enumeration
enum DeploymentEnvironment {
  DEVELOPMENT
  STAGING
  PRODUCTION
}

/// Log level enumeration
enum LogLevel {
  DEBUG
  INFO
  WARN
  ERROR
}

/// Deployment type enumeration
enum DeploymentType {
  SERVICE
  AGENT
  WORKFLOW
  INTEGRATION
}

/// Deployment - Application/service deployments
model deployment {
  id          String                @id @default(cuid())
  name        String
  description String?
  type        DeploymentType        @default(SERVICE)
  status      DeploymentStatus      @default(PENDING)
  environment DeploymentEnvironment @default(DEVELOPMENT)
  version     String?
  url         String?

  // Git info
  commitHash String? @map("commit_hash")
  branch     String?

  // Build info
  buildCommand String? @map("build_command")
  outputDir    String? @map("output_dir")
  envVars      Json?   @map("env_vars")

  // Configuration
  config Json @default("{}")

  // Health & Stats (stored as JSON for flexibility)
  health Json?
  stats  Json?

  // Timing
  startedAt   DateTime? @map("started_at")
  completedAt DateTime? @map("completed_at")
  deployedAt  DateTime? @map("deployed_at")
  duration    Int? // seconds

  // Logs
  logs deploymentLog[]

  workspaceId String    @map("workspace_id")
  workspace   workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  createdById String?   @map("created_by_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  @@index([workspaceId])
  @@index([status])
  @@index([environment])
  @@index([type])
  @@index([createdAt])
  @@map("deployments")
}

/// DeploymentLog - Log entries for deployments
model deploymentLog {
  id           String     @id @default(cuid())
  deploymentId String     @map("deployment_id")
  deployment   deployment @relation(fields: [deploymentId], references: [id], onDelete: Cascade)
  level        LogLevel   @default(INFO)
  message      String     @db.Text
  metadata     Json?
  timestamp    DateTime   @default(now())

  @@index([deploymentId])
  @@index([level])
  @@index([timestamp])
  @@map("deployment_logs")
}

// =============================================================================
// Agent Models (Task Automation Agents)
// =============================================================================

/// Agent type enumeration
enum AgentType {
  TASK
  RESEARCH
  CODING
  DATA
  QA
  SUPPORT
  CUSTOM
}

/// Agent status enumeration (shared by agents, session managers, and subagents)
enum AgentStatus {
  ACTIVE
  INACTIVE
  PAUSED
  ERROR
}

/// Agent - AI agent for task automation and assistance
model agent {
  id               String      @id @default(cuid())
  name             String
  type             AgentType
  status           AgentStatus @default(INACTIVE)
  description      String?
  model            String      @default("claude-3-5-sonnet")
  temperature      Float       @default(0.7)
  maxTokens        Int         @default(4096) @map("max_tokens")
  topP             Float?      @map("top_p")
  frequencyPenalty Float?      @map("frequency_penalty")
  presencePenalty  Float?      @map("presence_penalty")
  tools            String[]    @default([])
  systemPrompt     String?     @map("system_prompt") @db.Text
  workspaceId      String      @map("workspace_id")
  createdById      String?     @map("created_by_id")
  createdAt        DateTime    @default(now()) @map("created_at")
  updatedAt        DateTime    @updatedAt @map("updated_at")

  // Performance stats
  tasksCompleted  Int       @default(0) @map("tasks_completed")
  successRate     Float     @default(0) @map("success_rate")
  avgResponseTime Float     @default(0) @map("avg_response_time")
  lastActiveAt    DateTime? @map("last_active_at")
  tokensUsed      Int       @default(0) @map("tokens_used")
  totalCost       Float     @default(0) @map("total_cost")

  workspace workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId])
  @@index([type])
  @@index([status])
  @@index([createdById])
  @@index([createdAt])
  @@map("agents")
}

// =============================================================================
// Saved Items Models (Later/Bookmarks)
// =============================================================================

/// Saved item type enumeration
enum SavedItemType {
  MESSAGE
  FILE
  LINK
  NOTE
}

/// Saved item status enumeration
enum SavedItemStatus {
  IN_PROGRESS
  ARCHIVED
  COMPLETED
}

/// SavedItem - User-saved items for later reference (bookmarks)
model savedItem {
  id          String          @id @default(cuid())
  itemType    SavedItemType   @map("item_type")
  status      SavedItemStatus @default(IN_PROGRESS)
  note        String?         @db.Text
  dueDate     DateTime?       @map("due_date")
  messageId   String?         @map("message_id")
  fileId      String?         @map("file_id")
  userId      String          @map("user_id")
  workspaceId String          @map("workspace_id")
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")
  completedAt DateTime?       @map("completed_at")
  archivedAt  DateTime?       @map("archived_at")

  // Relations
  message   message?  @relation(fields: [messageId], references: [id], onDelete: SetNull)
  file      file?     @relation(fields: [fileId], references: [id], onDelete: SetNull)
  user      user      @relation(fields: [userId], references: [id], onDelete: Cascade)
  workspace workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@unique([userId, messageId])
  @@unique([userId, fileId])
  @@index([userId])
  @@index([workspaceId])
  @@index([itemType])
  @@index([status])
  @@index([messageId])
  @@index([fileId])
  @@index([createdAt])
  @@map("saved_items")
}

// =============================================================================
// Session Manager & Subagent Models (Multi-tier Agent Architecture)
// =============================================================================

/// SessionManager - Session manager for orchestrating agent sessions (Claude Code/Flow sessions)
/// Maps to the concept of dynamically compiled Claude Code sessions with CLAUDE.md and workflows
model sessionManager {
  id             String  @id @default(cuid())
  name           String
  description    String?
  charterId      String  @map("charter_id")
  charterData    Json    @map("charter_data") // Full charter JSON for this SM
  disciplineId   String? @map("discipline_id") // Discipline this SM manages
  orchestratorId String  @map("orchestrator_id")

  isGlobal     Boolean     @default(false) // Can be invoked by any orchestrator
  globalConfig Json?       @map("global_config") // { invokeableBy: ['all'] | string[] }
  status       AgentStatus @default(INACTIVE)

  // Resource limits (per THREE-TIER-ARCHITECTURE: 10 sessions per orchestrator)
  maxConcurrentSubagents Int @default(20) @map("max_concurrent_subagents")
  tokenBudgetPerHour     Int @default(100000) @map("token_budget_per_hour")

  // Worktree configuration for Claude Code sessions
  worktreeConfig Json? @map("worktree_config") // Git worktree settings

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  orchestrator orchestrator @relation(fields: [orchestratorId], references: [id], onDelete: Cascade)
  subagents    subagent[]

  @@index([orchestratorId])
  @@index([disciplineId])
  @@index([status])
  @@index([isGlobal])
  @@map("session_managers")
}

/// Subagent - Specialized agent that performs specific tasks under session manager coordination
model subagent {
  id          String  @id @default(cuid())
  name        String
  description String?
  charterId   String  @map("charter_id") // Reference to charter document
  charterData Json    @map("charter_data") // Full charter JSON

  sessionManagerId String? @map("session_manager_id") // Parent session manager (null for global)

  isGlobal Boolean    @default(false) @map("is_global") // Available to any session manager
  scope    AgentScope @default(DISCIPLINE) // Visibility scope
  tier     Int        @default(3) // Agent tier (1=orchestrator, 2=SM, 3=subagent)

  // Capabilities
  capabilities Json     @default("[]") // List of capability strings
  mcpTools     String[] @default([]) @map("mcp_tools") // MCP tools this agent can use

  // Resource limits
  maxTokensPerTask Int @default(50000) @map("max_tokens_per_task")

  // Worktree requirements (fractional pattern: read-only vs write-access)
  worktreeRequirement String @default("none") @map("worktree_requirement") // none, read, write

  status AgentStatus @default(INACTIVE)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  sessionManager sessionManager? @relation(fields: [sessionManagerId], references: [id], onDelete: SetNull)

  @@index([sessionManagerId])
  @@index([scope])
  @@index([isGlobal])
  @@index([tier])
  @@index([status])
  @@map("subagents")
}

/// AgentScope - Scope enumeration for subagent visibility
enum AgentScope {
  UNIVERSAL // Available to all orchestrators/session managers
  DISCIPLINE // Available within a discipline
  WORKSPACE // Available within a workspace
  PRIVATE // Only available to parent session manager
}

// =============================================================================
// Charter Version Tracking Models (Phase 3.2.1)
// =============================================================================

/// CharterVersion - Version tracking for charter documents
model charterVersion {
  id             String   @id @default(cuid())
  charterId      String   @map("charter_id")
  orchestratorId String   @map("orchestrator_id")
  version        Int
  charterData    Json     @map("charter_data")
  changeLog      String?  @map("change_log")
  createdBy      String   @map("created_by")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  isActive       Boolean  @default(false) @map("is_active")

  orchestrator orchestrator @relation(fields: [orchestratorId], references: [id], onDelete: Cascade)
  creator      user         @relation(fields: [createdBy], references: [id])

  @@unique([orchestratorId, charterId, version])
  @@index([orchestratorId])
  @@index([charterId])
  @@map("charter_versions")
}

// =============================================================================
// Token Usage & Budget Models (Phase 4)
// =============================================================================

/// TokenUsage - Track token consumption for orchestrators
model TokenUsage {
  id             String       @id @default(uuid())
  orchestratorId String       @map("orchestrator_id")
  orchestrator   orchestrator @relation(fields: [orchestratorId], references: [id])
  sessionId      String?      @map("session_id")
  model          String
  inputTokens    Int          @map("input_tokens")
  outputTokens   Int          @map("output_tokens")
  totalTokens    Int          @map("total_tokens")
  cost           Decimal?     @db.Decimal(10, 6)
  taskType       String?      @map("task_type")
  createdAt      DateTime     @default(now()) @map("created_at")

  @@index([orchestratorId, createdAt])
  @@map("token_usage")
}

/// BudgetConfig - Budget configuration and limits for orchestrators
model BudgetConfig {
  id              String       @id @default(uuid())
  orchestratorId  String       @unique @map("orchestrator_id")
  orchestrator    orchestrator @relation(fields: [orchestratorId], references: [id])
  hourlyLimit     Int          @default(100000) @map("hourly_limit")
  dailyLimit      Int          @default(1000000) @map("daily_limit")
  monthlyLimit    Int          @default(10000000) @map("monthly_limit")
  autoPause       Boolean      @default(true) @map("auto_pause")
  alertThresholds Json         @default("[50, 75, 90]") @map("alert_thresholds")
  updatedAt       DateTime     @updatedAt @map("updated_at")

  @@map("budget_configs")
}

/// AuditLog - System-wide audit logging
model AuditLog {
  id           String   @id @default(uuid())
  actorId      String   @map("actor_id")
  actorType    String   @map("actor_type") // user, orchestrator, daemon, system
  action       String
  resourceType String   @map("resource_type")
  resourceId   String?  @map("resource_id")
  metadata     Json?
  ip           String?
  userAgent    String?  @map("user_agent")
  severity     String   @default("info")
  createdAt    DateTime @default(now()) @map("created_at")

  @@index([actorId, createdAt])
  @@index([action, createdAt])
  @@index([resourceType, resourceId])
  @@map("audit_logs")
}

/// BudgetAlert - Budget threshold alerts for orchestrators
model BudgetAlert {
  id             String       @id @default(uuid())
  orchestratorId String       @map("orchestrator_id")
  orchestrator   orchestrator @relation(fields: [orchestratorId], references: [id])
  level          String // warning, critical, emergency
  threshold      Int
  currentUsage   Int          @map("current_usage")
  message        String
  acknowledged   Boolean      @default(false)
  acknowledgedBy String?      @map("acknowledged_by")
  acknowledgedAt DateTime?    @map("acknowledged_at")
  createdAt      DateTime     @default(now()) @map("created_at")

  @@index([orchestratorId, createdAt])
  @@map("budget_alerts")
}

// =============================================================================
// Federation & Distributed Systems Models (Phase 5 - Enterprise Features)
// =============================================================================

/// FederationStatus - Status of a federated orchestrator node
enum FederationStatus {
  ONLINE
  OFFLINE
  BUSY
  DRAINING
}

/// DelegationStatus - Status of a delegated task
enum DelegationStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
}

/// NodeStatus - Status of a daemon node in the cluster
enum NodeStatus {
  ONLINE
  OFFLINE
  DEGRADED
  MAINTENANCE
}

/// FederationRegistry - Registry of federated orchestrator nodes for distributed task execution
model FederationRegistry {
  id              String           @id @default(uuid())
  orchestratorId  String           @unique @map("orchestrator_id")
  orchestrator    orchestrator     @relation(fields: [orchestratorId], references: [id])
  capabilities    String[]
  region          String
  maxSessions     Int              @default(100) @map("max_sessions")
  currentSessions Int              @default(0) @map("current_sessions")
  status          FederationStatus @default(OFFLINE)
  lastHeartbeat   DateTime?        @map("last_heartbeat")
  registeredAt    DateTime         @default(now()) @map("registered_at")

  @@map("federation_registry")
}

/// TaskDelegation - Task delegation between orchestrator nodes
model TaskDelegation {
  id                 String           @id @default(uuid())
  fromOrchestratorId String           @map("from_orchestrator_id")
  toOrchestratorId   String           @map("to_orchestrator_id")
  taskType           String           @map("task_type")
  taskPayload        Json             @map("task_payload")
  context            Json?
  status             DelegationStatus @default(PENDING)
  result             Json?
  error              String?
  createdAt          DateTime         @default(now()) @map("created_at")
  completedAt        DateTime?        @map("completed_at")

  @@map("task_delegations")
}

/// DaemonNode - Daemon node for distributed orchestrator infrastructure
model DaemonNode {
  id             String     @id @default(uuid())
  name           String
  host           String
  port           Int
  capabilities   String[]
  region         String
  status         NodeStatus @default(OFFLINE)
  cpuUsage       Float      @default(0) @map("cpu_usage")
  memoryUsage    Float      @default(0) @map("memory_usage")
  activeSessions Int        @default(0) @map("active_sessions")
  lastHeartbeat  DateTime?  @map("last_heartbeat")
  createdAt      DateTime   @default(now()) @map("created_at")

  @@map("daemon_nodes")
}

// =============================================================================
// AI Prompt Template Models (Phase 10 - AI Features)
// =============================================================================

/// PromptTemplate - Reusable AI prompt templates with variable interpolation
model promptTemplate {
  id          String   @id @default(cuid())
  name        String
  description String
  category    String   // writing, coding, analysis, brainstorming, documentation, communication, workflow, research, custom
  content     String   @db.Text // Template content with {{variable}} placeholders
  variables   Json     @default("[]") // Array of PromptVariable objects
  tags        String[] @default([])
  isPublic    Boolean  @default(false) @map("is_public")
  isSystem    Boolean  @default(false) @map("is_system") // System/built-in template
  version     Int      @default(1)
  usageCount  Int      @default(0) @map("usage_count")
  starCount   Int      @default(0) @map("star_count")
  authorId    String?  @map("author_id")
  workspaceId String?  @map("workspace_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  author   user?                   @relation(fields: [authorId], references: [id], onDelete: SetNull)
  stars    promptTemplateStar[]
  versions promptTemplateVersion[]

  @@index([authorId])
  @@index([workspaceId])
  @@index([category])
  @@index([isPublic])
  @@index([isSystem])
  @@index([createdAt])
  @@map("prompt_templates")
}

/// PromptTemplateStar - User stars/favorites for prompt templates
model promptTemplateStar {
  id                String         @id @default(cuid())
  promptTemplateId  String         @map("prompt_template_id")
  userId            String         @map("user_id")
  createdAt         DateTime       @default(now()) @map("created_at")
  promptTemplate    promptTemplate @relation(fields: [promptTemplateId], references: [id], onDelete: Cascade)
  user              user           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([promptTemplateId, userId])
  @@index([promptTemplateId])
  @@index([userId])
  @@map("prompt_template_stars")
}

/// PromptTemplateVersion - Version history for prompt templates
model promptTemplateVersion {
  id               String         @id @default(cuid())
  promptTemplateId String         @map("prompt_template_id")
  version          Int
  content          String         @db.Text
  variables        Json           @default("[]")
  changeLog        String?        @map("change_log")
  createdById      String         @map("created_by_id")
  createdAt        DateTime       @default(now()) @map("created_at")
  promptTemplate   promptTemplate @relation(fields: [promptTemplateId], references: [id], onDelete: Cascade)
  createdBy        user           @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@unique([promptTemplateId, version])
  @@index([promptTemplateId])
  @@index([createdById])
  @@map("prompt_template_versions")
}

// =============================================================================
// AI Feedback Models (Phase 10 - AI Feedback System)
// =============================================================================

/// AIFeedback sentiment enumeration
enum AIFeedbackSentiment {
  POSITIVE
  NEGATIVE
  NEUTRAL
}

/// AIFeedback - User feedback on AI responses
model aiFeedback {
  id           String               @id @default(cuid())
  responseId   String               @map("response_id") // AI response or message ID
  sentiment    AIFeedbackSentiment  // Quick feedback: thumbs up/down
  category     String?              // accuracy, helpfulness, clarity, relevance, tone, other
  comment      String?              @db.Text
  metadata     Json                 @default("{}") // Provider, model, prompt context, etc.
  isAnonymous  Boolean              @default(false) @map("is_anonymous")
  workspaceId  String               @map("workspace_id")
  userId       String?              @map("user_id") // Null if anonymous
  createdAt    DateTime             @default(now()) @map("created_at")
  updatedAt    DateTime             @updatedAt @map("updated_at")

  user      user?     @relation(fields: [userId], references: [id], onDelete: SetNull)
  workspace workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)

  @@index([workspaceId])
  @@index([userId])
  @@index([sentiment])
  @@index([category])
  @@index([createdAt])
  @@index([responseId])
  @@map("ai_feedback")
}
