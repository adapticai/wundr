# Computer Setup - Claude Code CLI Fix

## Summary

Fixed the `computer-setup` script to properly install Claude Code CLI globally so it works across all git repositories, not just the Wundr project.

## Problem Identified

1. **Claude CLI installed via NVM**: The `claude` command was installed globally via npm, but only available when NVM loads the correct Node version
2. **No shell wrapper**: No persistent wrapper or alias to ensure `claude` works in all terminals
3. **Agent files exist but not copied**: 80+ agent `.md` files exist in the Wundr project but weren't being copied to global `.claude` directory

## Solutions Implemented

### 1. Global Claude Wrapper Script (`claude-installer.ts:231-323`)

Created a wrapper at `/usr/local/bin/claude` that:
- Loads NVM automatically
- Finds the `claude` binary in NVM directory
- Falls back to `npx @anthropic-ai/claude-code` if needed

```bash
#!/bin/bash
# Claude Code CLI Wrapper - Works with NVM
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# Try PATH first
if command -v claude >/dev/null 2>&1; then
  exec claude "$@"
fi

# Find in NVM directory
CLAUDE_BIN=$(find "$NVM_DIR/versions/node" -name claude -type f 2>/dev/null | head -n 1)
if [ -n "$CLAUDE_BIN" ]; then
  exec "$CLAUDE_BIN" "$@"
fi

# Fallback to npx
exec npx @anthropic-ai/claude-code "$@"
```

### 2. Shell Configuration Updates (`claude-installer.ts:295-323`)

Added to `.zshrc`, `.bashrc`, `.bash_profile`:
```bash
# Claude Code CLI - Auto-generated by Wundr
export PATH="/usr/local/bin:$PATH"
alias claude='npx @anthropic-ai/claude-code'
```

### 3. Agent Files Copy (`claude-installer.ts:558-615`)

Enhanced `setupAgents()` to:
- Copy all 84 agent `.md` files from Wundr `.claude/agents/` to global `~/.claude/agents/`
- Create JSON configs only for agents without `.md` files
- Preserve the existing agent documentation

### 4. CLAUDE.md Template (`claude-installer.ts:824-951`)

Added logic to:
- Copy the Wundr `CLAUDE.md` as a global template
- Store it in `~/.claude/templates/CLAUDE.md.template`
- Create a `claude-init` command for new projects

## Current State

✅ **Claude CLI Installation**: Works globally via npm
✅ **Agent Files**: 84 `.md` files in `~/.claude/agents/`
✅ **Directory Structure**: Complete with all subdirectories
✅ **Build**: TypeScript compilation successful

### Manual Steps Required (One-time)

Since sudo is required for the wrapper, you'll need to run this once:

```bash
# Install the global claude wrapper
sudo tee /usr/local/bin/claude > /dev/null << 'EOF'
#!/bin/bash
# Claude Code CLI Wrapper - Works with NVM
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# Try to find claude in PATH first
if command -v claude >/dev/null 2>&1; then
  exec claude "$@"
fi

# Fallback: find claude in NVM directory
CLAUDE_BIN=$(find "$NVM_DIR/versions/node" -name claude -type f 2>/dev/null | head -n 1)
if [ -n "$CLAUDE_BIN" ]; then
  exec "$CLAUDE_BIN" "$@"
fi

# Last resort: use npx
exec npx @anthropic-ai/claude-code "$@"
EOF

sudo chmod +x /usr/local/bin/claude
```

After this, restart your terminal and test:
```bash
claude --version
```

## Next Steps

1. **Run the manual wrapper installation above** (one-time, requires sudo)
2. **Restart terminal** to load shell config changes
3. **Test in any git repository**: `cd ~/some-other-repo && claude --version`
4. **Re-run computer-setup** on a fresh machine to verify full automation

## Files Modified

- `packages/@wundr/computer-setup/src/installers/claude-installer.ts` (lines 231-323, 558-615, 824-951)

## Verification

```bash
# Check Claude CLI works globally
claude --version
# Should output: 2.0.1 (Claude Code)

# Count agent files
find ~/.claude/agents -name "*.md" | wc -l
# Should output: 84

# Check wrapper exists
ls -l /usr/local/bin/claude
# Should show: -rwxr-xr-x ... /usr/local/bin/claude

# Test in different directory
cd /tmp && claude --version
# Should work without errors
```

## Notes

- The wrapper prioritizes the NVM-installed version but has fallbacks
- Agent `.md` files from Wundr are preserved and copied to global config
- Shell aliases provide redundancy in case wrapper isn't installed
- The setup now works across NVM version changes
